# InsightEye - AI Website Analysis Platform

AI-powered website analysis platform that analyzes any website's functionality, tech stack, traffic patterns, and user experience using advanced AI models. Now powered by Supabase for scalable, managed backend infrastructure.

## üöÄ Quick Start

### Prerequisites
- **Python 3.9+** - Backend runtime
- **Node.js 16+** - Frontend runtime
- **OpenRouter API Key** - Required for AI analysis (get from https://openrouter.ai)
- **Supabase Account** (Optional) - For production database

### Option 1: Non-Docker Setup (Recommended for Development)

#### 1. Configure Environment:
```bash
# Copy environment template
cp .env.supabase.example .env

# Edit .env with your Supabase credentials (optional for development)
# For development, the simplified backend works without Supabase
```

#### 2. Install System Dependencies:
```bash
# macOS
brew install postgresql@14

# Ubuntu/Debian
sudo apt-get install postgresql postgresql-contrib

# Windows (use PostgreSQL installer or skip if using simplified backend)
```

#### 3. Setup Backend:
```bash
cd backend

# Create virtual environment
python3 -m venv venv

# Activate virtual environment
source venv/bin/activate  # On Windows: venv\Scripts\activate

# Install dependencies
pip install -r requirements.txt

# Install Playwright browsers (required for web scraping)
playwright install chromium
```

#### 4. Setup Frontend:
```bash
cd frontend

# Install dependencies
npm install
```

#### 5. Start Services:
```bash
# Start Backend (runs in background)
cd backend
source venv/bin/activate
python -m uvicorn app.main_simple:app --reload --host 0.0.0.0 --port 8000 > /tmp/backend.log 2>&1 &

# Start Frontend (runs in background)
cd frontend
npm run dev > /tmp/frontend.log 2>&1 &

# Check status
sleep 3
curl http://localhost:8000/health
curl -s http://localhost:3000 | head -5

# View logs if needed
# tail -f /tmp/backend.log
# tail -f /tmp/frontend.log
```

#### 6. Access Your Application:
- **Frontend**: http://localhost:3000
- **Backend API**: http://localhost:8000
- **API Documentation**: http://localhost:8000/docs

### Option 2: Full Setup with Supabase (Production)

1. **Configure Supabase**:
   ```bash
   # Edit .env with your Supabase credentials
   USE_SUPABASE=true
   SUPABASE_URL=https://your-project.supabase.co
   SUPABASE_ANON_KEY=your-anon-key
   SUPABASE_SERVICE_ROLE_KEY=your-service-role-key
   ```

2. **Install Full Dependencies**:
   ```bash
   cd backend
   python3 -m venv venv
   source venv/bin/activate
   pip install -r requirements.txt
   ```

3. **Set Up Database Schema**:
   ```bash
   # Run in your Supabase SQL Editor:
   # 1. supabase/migrations/001_initial_schema.sql
   # 2. supabase/migrations/002_rls_policies.sql
   ```

4. **Start Services**:
   ```bash
   # Terminal 1: Backend (Full Mode)
   cd backend
   source venv/bin/activate
   python -m uvicorn app.main:app --reload

   # Terminal 2: Frontend
   cd frontend
   npm run dev
   ```

## ‚ú® Features

- **üß† Real AI Analysis**: Powered by OpenRouter with Google Gemini 2.0 Flash - No simulation data
- **üîß Tech Detection**: Identify frameworks, libraries, and tools using Playwright web scraping
- **üìä Traffic Insights**: Analyze performance and user behavior
- **üé® UX Evaluation**: Review design and user experience
- **‚òÅÔ∏è Supabase Integration**: Managed database with real-time features
- **üîí Row Level Security**: Secure data access with user-based policies
- **üìÅ File Storage**: Store reports and analysis assets
- **üîÑ Real-time Updates**: Live analysis progress updates

### üéØ Real AI Analysis
- ‚úÖ **No Mock Data**: All analysis results are generated by real AI models
- ‚ö° **Fast Analysis**: 30-60 seconds per website
- ü§ñ **Powered by OpenRouter**: Uses Google Gemini 2.0 Flash API
- ‚ö†Ô∏è **Rate Limits**: Free tier has request limits - wait between analyses if needed

## üèóÔ∏è Tech Stack

- **Frontend**: Next.js 14, React, TypeScript, TailwindCSS
- **Backend**: FastAPI, Python, SQLAlchemy (Async)
- **Database**: Supabase (Managed PostgreSQL)
- **AI**: OpenRouter API with multiple models
- **Authentication**: Supabase Auth + Auth0 (hybrid)
- **Background Jobs**: Celery with Redis
- **Real-time**: Supabase Realtime subscriptions

## üìã Available Commands

### Quick Start (Development)
```bash
# Start Backend (runs in background)
cd backend && source venv/bin/activate && python -m uvicorn app.main_simple:app --reload --host 0.0.0.0 --port 8000 > /tmp/backend.log 2>&1 &

# Start Frontend (runs in background)
cd frontend && npm run dev > /tmp/frontend.log 2>&1 &

# Check if services are running
sleep 3 && curl http://localhost:8000/health && echo "Backend: ‚úÖ" || echo "Backend: ‚ùå"
curl -s http://localhost:3000 > /dev/null && echo "Frontend: ‚úÖ" || echo "Frontend: ‚ùå"

# Stop services when done
pkill -f "uvicorn"
pkill -f "next dev"
```

### Production Setup with Full Features
```bash
# Terminal 1: Start Backend (Full mode with Supabase)
cd backend
source venv/bin/activate
python -m uvicorn app.main:app --reload

# Terminal 2: Start Frontend
cd frontend
npm run dev
```

### Individual Service Management
```bash
# Backend only (simplified)
cd backend && source venv/bin/activate && python -m uvicorn app.main_simple:app --reload

# Backend only (full)
cd backend && source venv/bin/activate && python -m uvicorn app.main:app --reload

# Frontend only
cd frontend && npm run dev

# Frontend build for production
cd frontend && npm run build
```

### Testing & Validation
```bash
# Test Supabase connection
python scripts/test_supabase.py

# Run frontend type checking
cd frontend && npm run type-check

# Build frontend
cd frontend && npm run build
```

## ‚öôÔ∏è Configuration

### Environment Variables

Create a `.env` file with your configuration:

```env
# Supabase Configuration (optional for local development)
USE_SUPABASE=false

# Required: OpenRouter API for AI Analysis
OPENROUTER_API_KEY=sk-or-v1-your-key-here

# Supabase Credentials (only if USE_SUPABASE=true)
SUPABASE_URL=https://your-project.supabase.co
SUPABASE_ANON_KEY=your-anon-key
SUPABASE_SERVICE_ROLE_KEY=your-service-role-key
SUPABASE_DB_PASSWORD=your-database-password

# Optional External APIs
SIMILARWEB_API_KEY=
AHREFS_API_KEY=

# Authentication (optional)
AUTH0_DOMAIN=your-domain.auth0.com
AUTH0_CLIENT_ID=your-client-id
AUTH0_CLIENT_SECRET=your-client-secret

# Security
SECRET_KEY=your-secret-key-here
```

### Database Modes

Switch between local PostgreSQL and Supabase:

```bash
# Use Supabase (recommended)
USE_SUPABASE=true

# Use local PostgreSQL
USE_SUPABASE=false
DATABASE_URL=postgresql://postgres:password@localhost:5432/insighteye
```

## üîå API Usage

```bash
# Analyze a website
curl -X POST http://localhost:8000/api/v1/analysis/analyze \
  -H "Content-Type: application/json" \
  -d '{"url": "https://example.com", "analysis_types": ["intent", "tech_stack", "ux"]}'

# Get analysis results
curl http://localhost:8000/api/v1/analysis/analyze/{analysis_id}

# List analyzed websites
curl http://localhost:8000/api/v1/websites?limit=10&offset=0
```

## üöÄ Deployment

### Development
```bash
# Local development with Supabase
./scripts/start_app.sh start
```

### Production Options

1. **Vercel + Supabase** (Recommended)
   - Frontend: Deploy to Vercel
   - Backend: Deploy to Railway/Render
   - Database: Supabase (already managed)

2. **Full Cloud Deployment**
   - Frontend: Vercel/Netlify
   - Backend: AWS Lambda/Google Cloud Run
   - Database: Supabase
   - Storage: Supabase Storage

3. **Traditional VPS**
   - Server: DigitalOcean/Linode
   - Process Manager: PM2/Supervisor
   - Database: Supabase
   - Reverse Proxy: Nginx

## üîß Troubleshooting

### Non-Docker Setup Issues

**Backend won't start (ModuleNotFoundError)**
```bash
# Solution: Use simplified backend (no heavy dependencies)
cd backend
source venv/bin/activate
python -m uvicorn app.main_simple:app --reload

# Or install minimal dependencies
pip install fastapi uvicorn pydantic python-dotenv
```

**Port 8000 already in use**
```bash
# Kill the process using port 8000
lsof -i :8000 | grep -v COMMAND | awk '{print $2}' | xargs kill -9

# Or use a different port
python -m uvicorn app.main_simple:app --port 8001
```

**Port 3000 already in use**
```bash
# Kill the process using port 3000
lsof -i :3000 | grep -v COMMAND | awk '{print $2}' | xargs kill -9

# Or use a different port
cd frontend && npm run dev -- -p 3001
```

**Python version issues**
```bash
# Check Python version (must be 3.9+)
python3 --version

# Create venv with specific Python version
python3.9 -m venv venv
# or
python3.11 -m venv venv
```

**Virtual environment not activating**
```bash
# macOS/Linux
source backend/venv/bin/activate

# Windows (PowerShell)
backend\venv\Scripts\Activate.ps1

# Windows (cmd)
backend\venv\Scripts\activate.bat
```

### Supabase Connection Issues

**Supabase Connection Failed**
```bash
# Check credentials
python scripts/test_supabase.py

# Verify environment variables
echo $SUPABASE_URL
echo $SUPABASE_SERVICE_ROLE_KEY
```

**Dependencies Issues**
```bash
# Reinstall backend dependencies
cd backend
rm -rf venv
python3 -m venv venv
source venv/bin/activate
pip install -r requirements.txt
playwright install chromium

# Reinstall frontend dependencies
cd frontend
rm -rf node_modules
npm install
```

**Playwright Browser Installation Issues**
```bash
# If playwright browsers fail to install
cd backend
source venv/bin/activate
playwright install chromium --force

# If still failing, install system dependencies (Ubuntu/Debian)
playwright install-deps chromium
```

**OpenRouter API Rate Limit (429 Error)**
```bash
# Solution: Wait 1-2 minutes between analysis requests
# Or upgrade to a paid OpenRouter API key for higher limits
# Free tier: Limited requests per minute
```

**Web Scraping Timeout**
```bash
# If analysis times out, the website may be slow or blocking scrapers
# Check backend logs: tail -f /tmp/backend.log
# Some websites have anti-scraping protection
```

**Database Schema Issues**
```bash
# Re-run migrations in Supabase SQL Editor
# 1. supabase/migrations/001_initial_schema.sql
# 2. supabase/migrations/002_rls_policies.sql
```

### Getting Help

- Check the **Supabase Setup Guide**: `SUPABASE_SETUP.md`
- Run the test suite: `python scripts/test_supabase.py`
- Frontend logs: Check browser console (F12)
- Backend logs: Check terminal output
- Supabase Documentation: https://supabase.com/docs

## üìö Documentation

- **`SUPABASE_SETUP.md`** - Complete Supabase setup guide
- **`SUPABASE_MIGRATION_SUMMARY.md`** - Migration overview and features
- **`supabase/migrations/`** - Database schema files
- **`scripts/`** - Setup and management scripts

## ü§ù Contributing

1. Fork the repository
2. Create your feature branch: `git checkout -b feature/amazing-feature`
3. Commit your changes: `git commit -m 'Add amazing feature'`
4. Push to the branch: `git push origin feature/amazing-feature`
5. Open a Pull Request

### Development Setup
```bash
# Clone and setup
git clone <your-fork>
cd icai
./scripts/setup_supabase.sh

# Start development environment
./scripts/start_app.sh start
```

## üìÑ License

MIT License - see [LICENSE](LICENSE) file for details.

---

## üéâ What's New with Supabase

‚úÖ **Managed Database** - No more PostgreSQL maintenance
‚úÖ **Real-time Features** - Live analysis updates
‚úÖ **Built-in Authentication** - Secure user management
‚úÖ **File Storage** - Store reports and assets
‚úÖ **Global CDN** - Fast worldwide access
‚úÖ **Automatic Backups** - Data safety guaranteed
‚úÖ **Row Level Security** - Fine-grained access control
‚úÖ **Developer Dashboard** - Visual database management

**Ready to scale?** Your InsightEye platform is now powered by enterprise-grade infrastructure! üöÄ